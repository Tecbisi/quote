<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>PDF Quote Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>

      /* Basic reset and typography */
      body {
        font-family: Arial, sans-serif;
        background-color: #ffffff;
        color: #333;
        margin: 0;
        padding-top: 60px; /* for fixed header */
        padding-bottom: 100px; /* for fixed footer */
        min-height: 100vh;
        position: relative;
      }

      /* Header */
      header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #0051a2;
        color: white;
        padding: 15px 20px;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      /* Language selector styling */
      #languageSelect {
        background-color: white;
        border-radius: 5px;
        border: 1px solid #ccc;
        padding: 6px 12px;
        font-size: 14px;
        cursor: pointer;
        min-width: 110px;
      }

      /* Container */
      #container {
        width: 80%;
        max-width: 900px;
        margin: 0 auto;
        background-color: rgb(64 64 64 / 0.02);
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }

      h1 {
        margin-top: 10px;
      }
      
   
      h3 {
        margin-top: 0px;
      }

      input,
      button,
      select {
        padding: 8px;
        margin: 5px 5px 15px 0;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      input[type="number"] {
        width: 90%;
        box-sizing: border-box;
      }
      
       input[type="text"] {
        width: 100%;
        box-sizing: border-box;
      }

      /* Table styling */
      table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
      }

      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
      }

      /* Buttons */
      .add-service {
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
        padding: 10px 15px;
      }

      .add-service:hover {
        background-color: #0056b3;
      }

      .export-pdf {
        background-color: #dc3545;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
        padding: 10px 15px;
        margin-top: 10px;
      }

      .export-pdf:hover {
        background-color: #a71d2a;
      }

      /* Total box */
      .total-box {
        font-weight: bold;
        margin-top: 20px;
      }

      /* Footer styling */
      footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #0051a2;
        color: white;
        padding: 12px 20px;
        text-align: center;
        font-size: 14px;
        border-top: 1px solid #003b70;
        line-height: 1.4;
        white-space: pre-line; /* respect line breaks */
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        #container {
          width: 95%;
          padding: 15px;
        }

        input[type="text"]
        
        input[type="number"] {
          width: 100%;
          margin-bottom: 12px;
        }

        input,
        button,
        select {
          margin-right: 0;
        }

        .add-service,
        .export-pdf {
          width: 100%;
          padding: 12px 0;
          margin-top: 12px;
        }

        header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
          font-size: 18px;
        }

        #languageSelect {
          min-width: 100%;
        }
      }
      /* Add textarea styles */
      textarea {
        width: 100%;
        min-height: 80px;
        padding: 8px;
        margin: 0px 0px 0px 0;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
        box-sizing: border-box;
        resize: vertical;
      }
    </style>
  </head>
  <body>
    <header>
      <div id="headerTitle">PDF Quote Generator</div>
      <select id="languageSelect" aria-label="Select Language">
        <option value="en" selected>English</option>
        <option value="fr">FranÃ§ais</option>
        <option value="it">Italiano</option>
      </select>
    </header>

    <div id="container">
      <h1 id="title">Quote Form</h1>

      <!-- Added quote title input -->
      <h3 id="quoteTitleLabel">Quote Title</h3>
      <input type="text" id="quoteTitle" placeholder="Enter quote title here" />

      <h3 id="clientInfoTitle">Client Information</h3>
      <input type="text" id="clientName" placeholder="Client Name" />
      <input type="text" id="clientEmail" placeholder="Client Email" />

      <h3 id="servicesTitle">Services</h3>
      <table id="servicesTable" aria-label="Services Table">
        <thead>
          <tr>
            <th id="descHeader">Description</th>
            <th id="hoursHeader">Hours</th>
            <th id="unitPriceHeader">Unit Price (â‚¬)</th>
            <th id="totalHeader">Total (â‚¬)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <button class="add-service" onclick="addService()" id="addServiceBtn">+ Add Service</button>

      <div class="total-box">
        <p><span id="subtotalLabel">Subtotal:</span> <span id="subtotal">0.00</span> â‚¬</p>
        <p><span id="totalLabel">Total:</span> <span id="total">0.00</span> â‚¬</p>
      </div>

      <!-- Added description textarea -->
      <h3 id="descriptionLabel">Description / Notes</h3>
      <textarea id="quoteDescription" placeholder="Enter any additional description or notes here"></textarea>

      <button class="export-pdf" onclick="exportPDF()" id="exportPdfBtn">ðŸ“„ Export as PDF</button>
    </div>

    <footer>
      <span id="footerText"></span>
    </footer>

    <script>
      // Updated translations including new fields
      const translations = {
        en: {
          headerTitle: "PDF Quote Generator",
          title: "Quote Form",
          quoteTitleLabel: "Quote Title",
          clientInfoTitle: "Client Information",
          clientNamePlaceholder: "Client Name",
          clientEmailPlaceholder: "Client Email",
          servicesTitle: "Services",
          descHeader: "Description",
          hoursHeader: "Hours",
          unitPriceHeader: "Unit Price (â‚¬)",
          totalHeader: "Total (â‚¬)",
          addServiceBtn: "+ Add Service",
          subtotalLabel: "Subtotal:",
          totalLabel: "Total:",
          exportPdfBtn: "ðŸ“„ Export as PDF",
          descriptionLabel: "Description / Notes",
          footerText: (year) =>
            `Â© 2025 - ${year} - All rights reserved.\nNB: Your information entered in this webpage is not stored anywhere. On reload, all data will be lost.`,
        },
        fr: {
          headerTitle: "GÃ©nÃ©rateur de devis PDF",
          title: "Formulaire de devis",
          quoteTitleLabel: "Titre du devis",
          clientInfoTitle: "Informations client",
          clientNamePlaceholder: "Nom du client",
          clientEmailPlaceholder: "Email du client",
          servicesTitle: "Services",
          descHeader: "Description",
          hoursHeader: "Heures",
          unitPriceHeader: "Prix unitaire (â‚¬)",
          totalHeader: "Total (â‚¬)",
          addServiceBtn: "+ Ajouter un service",
          subtotalLabel: "Sous-total :",
          totalLabel: "Total :",
          exportPdfBtn: "ðŸ“„ Exporter en PDF",
          descriptionLabel: "Description / Notes",
          footerText: (year) =>
            `Â© 2025 - ${year} - Tous droits rÃ©servÃ©s.\nNB : Vos informations saisies dans cette page ne sont pas stockÃ©es. En cas de rechargement, toutes les donnÃ©es seront perdues.`,
        },
        it: {
          headerTitle: "Generatore di preventivi PDF",
          title: "Modulo preventivo",
          quoteTitleLabel: "Titolo del preventivo",
          clientInfoTitle: "Informazioni cliente",
          clientNamePlaceholder: "Nome cliente",
          clientEmailPlaceholder: "Email cliente",
          servicesTitle: "Servizi",
          descHeader: "Descrizione",
          hoursHeader: "Ore",
          unitPriceHeader: "Prezzo unitario (â‚¬)",
          totalHeader: "Totale (â‚¬)",
          addServiceBtn: "+ Aggiungi servizio",
          subtotalLabel: "Totale parziale:",
          totalLabel: "Totale:",
          exportPdfBtn: "ðŸ“„ Esporta come PDF",
          descriptionLabel: "Descrizione / Note",
          footerText: (year) =>
            `Â© 2025 - ${year} - Tutti i diritti riservati.\nNB: Le informazioni inserite in questa pagina non vengono memorizzate da nessuna parte. Al ricaricamento, tutti i dati saranno persi.`,
        },
      };

      const elementsToTranslate = {
        headerTitle: document.getElementById("headerTitle"),
        title: document.getElementById("title"),
        quoteTitleLabel: document.getElementById("quoteTitleLabel"),
        clientInfoTitle: document.getElementById("clientInfoTitle"),
        clientName: document.getElementById("clientName"),
        clientEmail: document.getElementById("clientEmail"),
        servicesTitle: document.getElementById("servicesTitle"),
        descHeader: document.getElementById("descHeader"),
        hoursHeader: document.getElementById("hoursHeader"),
        unitPriceHeader: document.getElementById("unitPriceHeader"),
        totalHeader: document.getElementById("totalHeader"),
        addServiceBtn: document.getElementById("addServiceBtn"),
        subtotalLabel: document.getElementById("subtotalLabel"),
        totalLabel: document.getElementById("totalLabel"),
        exportPdfBtn: document.getElementById("exportPdfBtn"),
        descriptionLabel: document.getElementById("descriptionLabel"),
        footerText: document.getElementById("footerText"),
      };

      function setLanguage(lang) {
        const t = translations[lang];
        const currentYear = new Date().getFullYear();

        elementsToTranslate.headerTitle.textContent = t.headerTitle;
        elementsToTranslate.title.textContent = t.title;
        elementsToTranslate.quoteTitleLabel.textContent = t.quoteTitleLabel;
        elementsToTranslate.clientInfoTitle.textContent = t.clientInfoTitle;
        elementsToTranslate.clientName.placeholder = t.clientNamePlaceholder;
        elementsToTranslate.clientEmail.placeholder = t.clientEmailPlaceholder;
        elementsToTranslate.servicesTitle.textContent = t.servicesTitle;
        elementsToTranslate.descHeader.textContent = t.descHeader;
        elementsToTranslate.hoursHeader.textContent = t.hoursHeader;
        elementsToTranslate.unitPriceHeader.textContent = t.unitPriceHeader;
        elementsToTranslate.totalHeader.textContent = t.totalHeader;
        elementsToTranslate.addServiceBtn.textContent = t.addServiceBtn;
        elementsToTranslate.subtotalLabel.textContent = t.subtotalLabel;
        elementsToTranslate.totalLabel.textContent = t.totalLabel;
        elementsToTranslate.exportPdfBtn.textContent = t.exportPdfBtn;
        elementsToTranslate.descriptionLabel.textContent = t.descriptionLabel;
        elementsToTranslate.footerText.textContent = t.footerText(currentYear);
      }

      // Handle language selection change
      document
        .getElementById("languageSelect")
        .addEventListener("change", (e) => {
          setLanguage(e.target.value);
        });

      // Initialize language
      setLanguage("en");

      function addService() {
        const tbody = document.querySelector("#servicesTable tbody");
        const row = document.createElement("tr");

        row.innerHTML = `
          <td><input type="text" class="desc"></td>
          <td><input type="number" class="qty" value="1" min="1" onchange="calculateTotals()"></td>
          <td><input type="number" class="unitPrice" value="0" min="0" step="0.01" onchange="calculateTotals()"></td>
          <td class="lineTotal">0.00</td>
        `;

        tbody.appendChild(row);
        calculateTotals();
      }

      function calculateTotals() {
        const rows = document.querySelectorAll("#servicesTable tbody tr");
        let subtotal = 0;

        rows.forEach((row) => {
          const qty = parseFloat(row.querySelector(".qty").value) || 0;
          const unitPrice = parseFloat(row.querySelector(".unitPrice").value) || 0;
          const lineTotal = qty * unitPrice;
          row.querySelector(".lineTotal").textContent = lineTotal.toFixed(2);
          subtotal += lineTotal;
        });

        document.getElementById("subtotal").textContent = subtotal.toFixed(2);
        // For now, total = subtotal (no tax or other)
        document.getElementById("total").textContent = subtotal.toFixed(2);
      }

      // Export PDF function with fixes and added quote title and description
      async function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Quote Title (bigger font, top)
        const quoteTitle = document.getElementById("quoteTitle").value || elementsToTranslate.title.textContent;
        doc.setFontSize(20);
        doc.text(quoteTitle, 14, 22);

        // Client info (smaller font, below title)
        const clientName = document.getElementById("clientName").value;
        const clientEmail = document.getElementById("clientEmail").value;
        doc.setFontSize(12);
        doc.text(`${elementsToTranslate.clientInfoTitle.textContent}:`, 14, 32);
        doc.text(`${elementsToTranslate.clientName.placeholder}: ${clientName}`, 14, 40);
        doc.text(`${elementsToTranslate.clientEmail.placeholder}: ${clientEmail}`, 14, 48);

        // Table headers and data
        const services = [];
        document.querySelectorAll("#servicesTable tbody tr").forEach((row) => {
          const desc = row.querySelector(".desc").value;
          const qty = row.querySelector(".qty").value;
          const unitPrice = row.querySelector(".unitPrice").value;
          const total = row.querySelector(".lineTotal").textContent;

          if (desc.trim() !== "") {
            services.push([desc, qty, unitPrice, total]);
          }
        });

        let startY = 58;
        if (services.length > 0) {
          doc.autoTable({
            startY,
            head: [[
              elementsToTranslate.descHeader.textContent,
              elementsToTranslate.hoursHeader.textContent,
              elementsToTranslate.unitPriceHeader.textContent,
              elementsToTranslate.totalHeader.textContent,
            ]],
            body: services,
            styles: { fontSize: 10 },
          });
          startY = doc.lastAutoTable.finalY + 10;
        }

        // Totals at bottom
        doc.text(
          `${elementsToTranslate.subtotalLabel.textContent} ${document.getElementById("subtotal").textContent} â‚¬`,
          14,
          startY
        );
        doc.text(
          `${elementsToTranslate.totalLabel.textContent} ${document.getElementById("total").textContent} â‚¬`,
          14,
          startY + 8
        );

        // Add description/notes below totals
        const description = document.getElementById("quoteDescription").value.trim();
        if (description) {
          doc.setFontSize(12);
          doc.text(elementsToTranslate.descriptionLabel.textContent + ":", 14, startY + 22);

          // Handle multi-line text with wrapping
          const splitDescription = doc.splitTextToSize(description, 180);
          doc.text(splitDescription, 14, startY + 30);
        }

        doc.save("quote.pdf");
      }

      // Add initial one service row
      addService();
    </script>
  </body>
</html>
